<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="GISTNORTH, Chiang Mai University">
        <link rel="canonical" href="https://dookda.github.io/gistnorth_gee/gee_workshop_chapter9/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>บทที่ 9 - Google Earth Engine Workshop (GISTNORTH)</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Google Earth Engine Workshop (GISTNORTH)</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">หน้าแรก</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter1/" class="nav-link">บทที่ 1</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter2/" class="nav-link">บทที่ 2</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter3/" class="nav-link">บทที่ 3</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter4/" class="nav-link">บทที่ 4</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter5/" class="nav-link">บทที่ 5</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter6/" class="nav-link">บทที่ 6</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter7/" class="nav-link">บทที่ 7</a>
                            </li>
                            <li class="nav-item">
                                <a href="../gee_workshop_chapter8/" class="nav-link">บทที่ 8</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">บทที่ 9</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../gee_workshop_chapter8/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/dookda/gistnorth_gee/edit/master/docs/gee_workshop_chapter9.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h3 id="91-flood-detection-using-sentinel-1-sar-data">9.1 Flood Detection using Sentinel-1 SAR Data<a class="headerlink" href="#91-flood-detection-using-sentinel-1-sar-data" title="Permanent link">&para;</a></h3>
<p>Credit: <a href="https://www.un-spider.org/advisory-support/recommended-practices/recommended-practice-flood-mapping/step-by-step">UN-SPIDER</a></p>
<h4 id="1-region-of-interest">1.กำหนดพื้นที่ศึกษา (Region of Interest)<a class="headerlink" href="#1-region-of-interest" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 1. Define region of interest (adjust coordinates as needed)</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">geometry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Geometry</span><span class="p">.</span><span class="nx">Polygon</span><span class="p">(</span>
<span class="w">        </span><span class="p">[[[</span><span class="mf">99.78173820585737</span><span class="p">,</span><span class="w"> </span><span class="mf">20.530460641212706</span><span class="p">],</span>
<span class="w">          </span><span class="p">[</span><span class="mf">99.78173820585737</span><span class="p">,</span><span class="w"> </span><span class="mf">20.343223656107035</span><span class="p">],</span>
<span class="w">          </span><span class="p">[</span><span class="mf">100.15664665312299</span><span class="p">,</span><span class="w"> </span><span class="mf">20.343223656107035</span><span class="p">],</span>
<span class="w">          </span><span class="p">[</span><span class="mf">100.15664665312299</span><span class="p">,</span><span class="w"> </span><span class="mf">20.530460641212706</span><span class="p">]]]);</span>

<span class="c1">// 2. Define the area of interest as a FeatureCollection</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">aoi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">FeatureCollection</span><span class="p">(</span><span class="nx">geometry</span><span class="p">);</span>
</code></pre></div>
<h4 id="2">2.กำหนดช่วงเวลาที่สนใจ<a class="headerlink" href="#2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 3. Define date ranges for before and after flood events</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">before_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">before_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-05-24&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">after_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-09-15&#39;</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">after_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2024-10-10&#39;</span><span class="p">;</span>
</code></pre></div>
<h4 id="3-sentinel-1">3.โหลดข้อมูล Sentinel-1 และกรองตามพารามิเตอร์ที่กำหนด<a class="headerlink" href="#3-sentinel-1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 4. Define parameters for Sentinel-1 data</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">polarization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;VH&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#39;VV&#39;  &#39;VH&#39; </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">pass_direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DESCENDING&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#39;DESCENDING&#39; หรือ &#39;ASCENDING&#39;</span>
<span class="c1">// Load and filter Sentinel-1 GRD  </span>
<span class="kd">var</span><span class="w"> </span><span class="nx">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="s1">&#39;COPERNICUS/S1_GRD&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="s1">&#39;instrumentMode&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;IW&#39;</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">listContains</span><span class="p">(</span><span class="s1">&#39;transmitterReceiverPolarisation&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">polarization</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="s1">&#39;orbitProperties_pass&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">pass_direction</span><span class="p">))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="s1">&#39;resolution_meters&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">))</span>
<span class="w">    </span><span class="c1">//.filter(ee.Filter.eq(&#39;relativeOrbitNumber_start&#39;,relative_orbit ))</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filterBounds</span><span class="p">(</span><span class="nx">aoi</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">polarization</span><span class="p">);</span>
<span class="c1">// Filter date</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">before_collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="nx">before_start</span><span class="p">,</span><span class="w"> </span><span class="nx">before_end</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">after_collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">collection</span><span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="nx">after_start</span><span class="p">,</span><span class="w"> </span><span class="nx">after_end</span><span class="p">);</span>

<span class="c1">// Create mosaics for before and after periods</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">before_collection</span><span class="p">.</span><span class="nx">mosaic</span><span class="p">().</span><span class="nx">clip</span><span class="p">(</span><span class="nx">aoi</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">after_collection</span><span class="p">.</span><span class="nx">mosaic</span><span class="p">().</span><span class="nx">clip</span><span class="p">(</span><span class="nx">aoi</span><span class="p">);</span>
</code></pre></div>
<h4 id="4">4.คำนวณความแตกต่างของสัญญาณเรดาร์ระหว่างสองช่วงเวลา<a class="headerlink" href="#4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 5. Calculate the difference in backscatter between the two periods</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">smoothing_radius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">25</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">before_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">before</span><span class="p">.</span><span class="nx">focal_mean</span><span class="p">(</span><span class="nx">smoothing_radius</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;circle&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meters&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">after_filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">after</span><span class="p">.</span><span class="nx">focal_mean</span><span class="p">(</span><span class="nx">smoothing_radius</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;circle&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meters&#39;</span><span class="p">);</span>
<span class="c1">// Define a threshold for flood detection</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">difference_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">5.5</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">difference_db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">after_filtered</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">before_filtered</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">difference_binary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">difference_db</span><span class="p">.</span><span class="nx">lte</span><span class="p">(</span><span class="nx">difference_threshold</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">flood_raw_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">difference_db</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">difference_binary</span><span class="p">);</span>
</code></pre></div>
<h4 id="5-mask">5.ปรับปรุง mask น้ำท่วมโดยใช้เกณฑ์อื่น ๆ<a class="headerlink" href="#5-mask" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 6. Refine the flood mask using additional criteria</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">swater</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="s1">&#39;JRC/GSW1_0/GlobalSurfaceWater&#39;</span><span class="p">).</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;seasonality&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">swater_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">swater</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="mf">5</span><span class="p">).</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">swater</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="mf">5</span><span class="p">));</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">flooded_mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">difference_binary</span><span class="p">.</span><span class="nx">where</span><span class="p">(</span><span class="nx">swater_mask</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">flooded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flooded_mask</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">flooded_mask</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flooded</span><span class="p">.</span><span class="nx">connectedPixelCount</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">flooded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flooded</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">connections</span><span class="p">.</span><span class="nx">gte</span><span class="p">(</span><span class="mf">8</span><span class="p">));</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">dem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="s1">&#39;WWF/HydroSHEDS/03VFDEM&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">terrain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Algorithms</span><span class="p">.</span><span class="nx">Terrain</span><span class="p">(</span><span class="nx">dem</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">terrain</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;slope&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">flooded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">flooded</span><span class="p">.</span><span class="nx">updateMask</span><span class="p">(</span><span class="nx">slope</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="mf">5</span><span class="p">));</span>
</code></pre></div>
<h4 id="6">6.แสดงผลลัพธ์<a class="headerlink" href="#6" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 7. Display the results</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">centerObject</span><span class="p">(</span><span class="nx">aoi</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">before_filtered</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;Before Flood&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">after_filtered</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">25</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;After Flood&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">difference_db</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;Difference (dB)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">flood_raw_mask</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">palette</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;Flooded (raw)&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">flooded</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">palette</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;blue&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;Flooded Areas&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
</code></pre></div>
<h3 id="92-drought-monitoring-using-chirps-precipitation-data">9.2 Drought Monitoring using CHIRPS Precipitation Data<a class="headerlink" href="#92-drought-monitoring-using-chirps-precipitation-data" title="Permanent link">&para;</a></h3>
<h4 id="1-thailand-boundary-chirps-monthly-precipitation">1.โหลดข้อมูล Thailand boundary และ CHIRPS monthly precipitation<a class="headerlink" href="#1-thailand-boundary-chirps-monthly-precipitation" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 1. Load Thailand boundary</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">thailand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">FeatureCollection</span><span class="p">(</span><span class="s1">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Filter</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="s1">&#39;country_na&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Thailand&#39;</span><span class="p">));</span>

<span class="c1">// 2. Load CHIRPS monthly precipitation and select the ‘precipitation’ band</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">precip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="s1">&#39;UCSB-CHG/CHIRPS/DAILY&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;precipitation&#39;</span><span class="p">);</span>
</code></pre></div>
<h4 id="2calculate-standardized-precipitation-index-spi-for-3-month-periods">2.Calculate Standardized Precipitation Index (SPI) for 3-month periods<a class="headerlink" href="#2calculate-standardized-precipitation-index-spi-for-3-month-periods" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 3. Define the “current” 3-month period ending April 2025</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">targetDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nb">Date</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">startPeriod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">targetDate</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;month&#39;</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">startPeriod</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">current3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">precip</span>
<span class="w">    </span><span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="nx">targetDate</span><span class="p">,</span><span class="w"> </span><span class="nx">startPeriod</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">sum</span><span class="p">();</span>
</code></pre></div>
<h4 id="3build-a-time-series-of-historical-3-month-sums">3.Build a time series of historical 3-month sums<a class="headerlink" href="#3build-a-time-series-of-historical-3-month-sums" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 4. Build a time series of historical 3-month sums (April–June each year)</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">List</span><span class="p">.</span><span class="nx">sequence</span><span class="p">(</span><span class="mf">1981</span><span class="p">,</span><span class="w"> </span><span class="mf">2023</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">historical3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">.</span><span class="nx">fromImages</span><span class="p">(</span>
<span class="w">    </span><span class="nx">years</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nb">Date</span><span class="p">.</span><span class="nx">fromYMD</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">  </span><span class="c1">//.advance(3, &#39;month&#39;);  // window start = April 1</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">start</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;month&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">precip</span>
<span class="w">            </span><span class="p">.</span><span class="nx">filterDate</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span><span class="w"> </span><span class="nx">end</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">sum</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;system:time_start&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="p">.</span><span class="nx">millis</span><span class="p">());</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">historical3mo</span><span class="p">);</span>
</code></pre></div>
<h4 id="4compute-mean-and-standard-deviation-images-from-the-historical-period">4.Compute mean and standard deviation images from the historical period<a class="headerlink" href="#4compute-mean-and-standard-deviation-images-from-the-historical-period" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 5. Compute mean and standard deviation images from the historical period</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">mean3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">historical3mo</span><span class="p">.</span><span class="nx">mean</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">stddev3mo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">historical3mo</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">stdDev</span><span class="p">());</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">mean3mo</span><span class="p">);</span>
</code></pre></div>
<h4 id="5calculate-the-spi-3-approximate-as-standardized-anomaly">5.Calculate the SPI-3 (approximate) as standardized anomaly<a class="headerlink" href="#5calculate-the-spi-3-approximate-as-standardized-anomaly" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 6. Calculate the SPI-3 (approximate) as standardized anomaly</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">spi3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">current3mo</span>
<span class="w">    </span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">mean3mo</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">divide</span><span class="p">(</span><span class="nx">stddev3mo</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">clip</span><span class="p">(</span><span class="nx">thailand</span><span class="p">);</span>
</code></pre></div>
<h4 id="6visualization-parameters-for-spi">6.Visualization parameters for SPI<a class="headerlink" href="#6visualization-parameters-for-spi" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 7. Visualization parameters for SPI</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">spiVis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span>
<span class="w">    </span><span class="nx">palette</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;#d73027&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// &lt;= -1.5 (severe drought)</span>
<span class="w">        </span><span class="s1">&#39;#fc8d59&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// -1.5 to -1.0</span>
<span class="w">        </span><span class="s1">&#39;#fee08b&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// -1.0 to -0.5</span>
<span class="w">        </span><span class="s1">&#39;#d9ef8b&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// -0.5 to 0.5 (near normal)</span>
<span class="w">        </span><span class="s1">&#39;#91cf60&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">// 0.5 to 1.0</span>
<span class="w">        </span><span class="s1">&#39;#1a9850&#39;</span><span class="w">  </span><span class="c1">// &gt; 1.0 (wet)</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">};</span>
</code></pre></div>
<h4 id="7display-the-spi-layer-and-add-a-legend">7.Display the SPI layer and add a legend<a class="headerlink" href="#7display-the-spi-layer-and-add-a-legend" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1">// 8. Display the SPI layer</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">centerObject</span><span class="p">(</span><span class="nx">thailand</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">spi3</span><span class="p">,</span><span class="w"> </span><span class="nx">spiVis</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;SPI-3 Apr 2024&#39;</span><span class="p">);</span>

<span class="c1">// 9. Add a legend panel</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Panel</span><span class="p">({</span>
<span class="w">    </span><span class="nx">style</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bottom-left&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;8px 15px&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">fontWeight</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;bold&#39;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
<span class="nx">legend</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">ui</span><span class="p">.</span><span class="nx">Label</span><span class="p">(</span><span class="s1">&#39;SPI-3 Legend&#39;</span><span class="p">));</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">makeRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">colorBox</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Label</span><span class="p">({</span>
<span class="w">        </span><span class="nx">style</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">backgroundColor</span><span class="o">:</span><span class="w"> </span><span class="nx">color</span><span class="p">,</span>
<span class="w">            </span><span class="nx">padding</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;8px&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">margin</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;0 0 4px 0&#39;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Label</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">margin</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;0 0 4px 6px&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Panel</span><span class="p">([</span><span class="nx">colorBox</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="p">],</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Panel</span><span class="p">.</span><span class="nx">Layout</span><span class="p">.</span><span class="nx">Flow</span><span class="p">(</span><span class="s1">&#39;horizontal&#39;</span><span class="p">));</span>
<span class="p">};</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">spiVis</span><span class="p">.</span><span class="nx">palette</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;&lt;= -1.5&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-1.5 to -1.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-1.0 to -0.5&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s1">&#39;-0.5 to 0.5&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.5 to 1.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&gt; 1.0&#39;</span><span class="p">];</span>

<span class="nx">palette</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">legend</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">makeRow</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span><span class="w"> </span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
<span class="p">});</span>

<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">current3mo</span><span class="p">.</span><span class="nx">clip</span><span class="p">(</span><span class="nx">thailand</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">400</span><span class="p">,</span><span class="w"> </span><span class="nx">palette</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#0000CD&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#00008B&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;current-rain&#39;</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">(</span><span class="nx">historical3mo</span><span class="p">.</span><span class="nx">mean</span><span class="p">().</span><span class="nx">clip</span><span class="p">(</span><span class="nx">thailand</span><span class="p">),</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="mf">500</span><span class="p">,</span><span class="w"> </span><span class="nx">palette</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#ADD8E6&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#0000CD&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#00008B&#39;</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="s1">&#39;3m-rain&#39;</span><span class="p">);</span>
<span class="nb">Map</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">legend</span><span class="p">);</span>
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
